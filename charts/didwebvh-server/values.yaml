---
nameOverride: "didwebvh-server"
fullnameOverride: "didwebvh-server"

selectorLabels: {}

ingress:
  tls: []
  labels: []
  annotations: []

networkPolicy:
  ingress:
    namespaceSelector: []

server:
  image:
    repository: ghcr.io/decentralized-identity/didwebvh-server-py
    tag: 0.5.0
    pullPolicy: IfNotPresent
    pullSecrets: []

  host: example.com

  workers: 4

  # Policies should be configured according to governance decisions
  policies:
    webvh_version: "1.0"
    webvh_witness: "true"
    webvh_watcher: ""
    webvh_prerotation: "true"
    webvh_portability: "true"
    webvh_endorsement: "true"
    webvh_known_witness_key: ""
    webvh_known_registry_url: ""

  branding:
    app_name: "DID WebVH Server"
    app_description: "An api server to register and serve web dids with verifiable history."
    icon: "https://didwebvh.info/latest/assets/favicon.ico"
    logo_vertical: "https://raw.githubusercontent.com/decentralized-identity/didwebvh-info/main/docs/assets/didwebvh.jpg"
    logo_horizontal: "https://raw.githubusercontent.com/decentralized-identity/didwebvh-info/main/docs/assets/didwebvh.jpg"
    app_primary_color: "#1a365d"
    app_secondary_color: "#38a169"
    app_accent_color: "#3182ce"

  replicaCount: 1

  podAnnotations: {}
  podSecurityContext: {}
  containerSecurityContext: {}

  service:
    type: ClusterIP
    apiPort: 8000
    servicePort: 8000

  networkPolicy:
    ingress:
      podSelector: {}

# CloudPirates Postgres subchart (replaces Bitnami PostgreSQL)
# Uses official postgres image; see README for migration from Bitnami.
postgres:
  enabled: true
  fullnameOverride: "didwebvh-server-postgres"

  auth:
    username: "didwebvh-server"
    database: "didwebvh-server"
    # password left empty: chart generates and stores in secret (key: postgres-password)
    existingSecret: ""

  config:
    postgresql:
      max_connections: 500

  service:
    port: 5432

  persistence:
    enabled: true
    size: 1Gi

  # Relax security context for compatibility; tighten as needed
  podSecurityContext:
    fsGroup: 999
  containerSecurityContext:
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    runAsUser: 999
    runAsGroup: 999
    readOnlyRootFilesystem: false
    capabilities:
      drop:
        - ALL
